<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photobooth</title>
    <style>
        body { background-color: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .booth-container { position: relative;
    border: 6px solid #333;
    border-radius: 20px;
    background: #000;
    /* Esto controla qu茅 tan grande se ve en la pantalla del celular */
    width: 320px; 
    height: 240px;
    margin: 0 auto;
    overflow: hidden; }
        #video { width: 100%;
    height: 100%;
    object-fit: cover; /* Esto hace que el video llene el cuadro sin deformarse */
    transform: scaleX(-1); }
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: bold; text-shadow: 0 0 20px rgba(0,0,0,0.8); z-index: 10; }
        #snap { margin: 20px; padding: 15px 40px; font-size: 20px; border-radius: 50px; background: #ff4757; color: white; border: none; cursor: pointer; font-weight: bold; }
        #photo-strip { background: white; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 300px; display: none; border: 1px solid #ddd; }
        #download-link { margin-top: 15px; color: #2ed573; font-weight: bold; text-decoration: none; display: none; }
        .flash { animation: flashAnim 0.2s; }
        @keyframes flashAnim { 0% { opacity: 0.5; background: white; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h1 style="color: #ff4757;">Photobooth</h1>
    
    <div class="booth-container" id="booth">
        <div id="countdown" style="display:none;">6</div>
        <video id="video" autoplay playsinline></video>
    </div>

    <button id="snap">隆EMPEZAR (6 seg entre fotos)!</button>

    <canvas id="canvas" width="400" height="1350" style="display:none;"></canvas>
    
    <img id="photo-strip">
    <a id="download-link" download="foto.png"> DESCARGAR TIRA</a>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d', { willReadFrequently: true });
        const stripImg = document.getElementById('photo-strip');
        const downloadBtn = document.getElementById('download-link');
        const countdownEl = document.getElementById('countdown');
        const snapBtn = document.getElementById('snap');

        // 1. Cargar el dise帽o con precauci贸n de seguridad
        const marco = new Image();
        marco.crossOrigin = "anonymous"; 
        marco.src = 'https://i.postimg.cc/BQ1FSZqN/Happy-Birthday-(1).png'; // <--- USA EL NOMBRE EXACTO DE TU ARCHIVO PNG

        navigator.mediaDevices.getUserMedia({ 
    video: { 
        width: { ideal: 1280 }, 
        height: { ideal: 720 },
        facingMode: "user" 
    } 
})
.then(stream => { 
    video.srcObject = stream;
    // Forzamos el play por si el navegador lo paus贸
    video.play();
})
.catch(err => {
    // Si falla lo anterior, intentamos una configuraci贸n b谩sica
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; });
});
})

        async function takePhotos() {
            snapBtn.disabled = true;
            stripImg.style.display = 'none';
            downloadBtn.style.display = 'none';

            // Limpiar canvas y poner fondo blanco
            context.fillStyle = "white";
            context.fillRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < 4; i++) {
                // Cuenta regresiva
                for (let count = 6; count > 0; count--) {
                    countdownEl.innerText = count;
                    countdownEl.style.display = 'block';
                    await new Promise(r => setTimeout(r, 1000));
                }

                // Efecto Flash
                document.getElementById('booth').classList.add('flash');
                countdownEl.innerText = "";
                
                // CAPTURA: Dibujamos el video en el canvas
                context.save();
                context.translate(canvas.width, 0);
                context.scale(-1, 1);
                
                // Ajuste de posici贸n: i * 310 para dejar espacio entre fotos
                // --- NUEVO CDIGO PARA EVITAR FOTOS ALARGADAS ---
const videoWidth = video.videoWidth;
const videoHeight = video.videoHeight;
const targetWidth = 360;
const targetHeight = 270;

// Calculamos la proporci贸n para recortar el centro
const videoAspect = videoWidth / videoHeight;
const targetAspect = targetWidth / targetHeight;

let sourceX = 0, sourceY = 0, sourceWidth = videoWidth, sourceHeight = videoHeight;

if (videoAspect > targetAspect) {
    sourceWidth = videoHeight * targetAspect;
    sourceX = (videoWidth - sourceWidth) / 2;
} else {
    sourceHeight = videoWidth / targetAspect;
    sourceY = (videoHeight - sourceHeight) / 2;
}

context.save();
context.translate(canvas.width, 0);
context.scale(-1, 1);

// Dibujamos solo el centro de la imagen capturada para que no se estire
context.drawImage(
    video, 
    sourceX, sourceY, sourceWidth, sourceHeight, // Qu茅 parte del video tomamos
    20, 50 + (i * 290), targetWidth, targetHeight // D贸nde lo ponemos en la tira
);
context.restore();
// ----------------------------------------------
            }

            // DIBUJAR TU MARCO AL FINAL
            if (marco.complete) {
                context.drawImage(marco, 0, 0, 400, 1350);
            } else {
                marco.onload = () => context.drawImage(marco, 0, 0, 400, 1350);
            }

            // FORZAR RENDERIZADO
            setTimeout(() => {
                const dataURL = canvas.toDataURL('image/png');
                if(dataURL.length > 100) { // Verificar que no est茅 vac铆o
                    stripImg.src = dataURL;
                    stripImg.style.display = 'block';
                    downloadBtn.href = dataURL;
                    downloadBtn.style.display = 'block';
                } else {
                    alert("Error al generar la imagen. Intenta abrirlo con un servidor local.");
                }
                snapBtn.disabled = false;
            }, 500);
        }

        snapBtn.addEventListener('click', takePhotos);
    </script>
</body>

</html>




